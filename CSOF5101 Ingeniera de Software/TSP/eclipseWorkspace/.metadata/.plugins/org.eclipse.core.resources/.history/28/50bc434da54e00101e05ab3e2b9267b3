package com.ingenium.tsp.control;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

/**
 * 
 * @author Ingenium
 */
public class IngeniumTSP {

	private Analizer analizer;
	private List<String> totalOutcome;

	public static void main(String... args) {
		StringBuffer projectPathBuffer = new StringBuffer();

		try {

			projectPathBuffer.append(new File(".").getCanonicalPath());
			projectPathBuffer.append(File.separator);
			projectPathBuffer.append("src");
			projectPathBuffer.append(File.separator);

		} catch (IOException e) {
			e.printStackTrace();
		}

		IngeniumTSP ingeniumTSP = new IngeniumTSP();
		ingeniumTSP.checkProject(projectPathBuffer.toString());
	}

	private IngeniumTSP() {
		analizer = new Analizer();
	}

	public void checkProject(String projectPath) {
		checkDirectory(projectPath);
		printResult();
	}

	private void printResult() {
		if (totalOutcome.get(0).contains("no existe")) {
			analizer.printFailedAnalysis(totalOutcome.get(0));
		} else {
			analizer.printSuccessfulAnalysis(totalOutcome);
		}
	}

	public List<String> checkDirectory(String directoryName) {
		totalOutcome = new ArrayList<String>();
		File directory = new File(directoryName);

		if (directory.exists() && directory.isDirectory()) {
			List<File> fileList = new ArrayList<File>();
			loadFileList(fileList, directory);

			for (File file : fileList) {
				totalOutcome.addAll(analizer.analizeFile(file));
			}
		} else {
			totalOutcome.add("El directorio " + directoryName + " no existe");
		}

		return totalOutcome;
	}

	private void loadFileList(List<File> fileList, File file) {
		if (file.isDirectory()) {
			for (File f : file.listFiles()) {
				loadFileList(fileList, f);
			}
		} else {
			fileList.add(file);
		}
	}

	public List<String> checkFile(String fileName) {
		totalOutcome = new ArrayList<String>();
		File file = new File(fileName);

		if (file.exists() && file.isFile()) {
			totalOutcome.addAll(analizer.analizeFile(file));
		} else {
			totalOutcome.add("El archivo " + fileName + " no existe");
		}

		return totalOutcome;
	}
}
